--------------------------------------------------
-- SERVICES
--------------------------------------------------
local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local VirtualUser = game:GetService("VirtualUser")

local player = Players.LocalPlayer
local camera = workspace.CurrentCamera

--------------------------------------------------
-- ANTI-AFK (JETZT WIRKLICH)
--------------------------------------------------
player.Idled:Connect(function()
	VirtualUser:Button2Down(Vector2.new(0,0), camera.CFrame)
	task.wait(1)
	VirtualUser:Button2Up(Vector2.new(0,0), camera.CFrame)
end)

--------------------------------------------------
-- RAYFIELD
--------------------------------------------------
local Rayfield = loadstring(game:HttpGet(
	"https://raw.githubusercontent.com/SiriusSoftwareLtd/Rayfield/main/source.lua"
))()

--------------------------------------------------
-- WINDOW + KEY
--------------------------------------------------
local Window = Rayfield:CreateWindow({
	Name = "Hacking",
	LoadingTitle = "Loading",
	LoadingSubtitle = "Fun Panel",
	KeySystem = true,
	KeySettings = {
		Title = "Key System",
		Subtitle = "Enter Key",
		Note = "Key = ADMIN",
		SaveKey = false,
		Key = "ADMIN"
	}
})

--------------------------------------------------
-- TABS
--------------------------------------------------
local PlayerTab = Window:CreateTab("Player", 4483362458)
local VehicleTab = Window:CreateTab("Vehicle", 4483362458)
local VisualTab = Window:CreateTab("Visuals", 4483362458)

--------------------------------------------------
-- CHARACTER
--------------------------------------------------
local character, humanoid, hrp
local function setupChar()
	character = player.Character or player.CharacterAdded:Wait()
	humanoid = character:WaitForChild("Humanoid")
	hrp = character:WaitForChild("HumanoidRootPart")
end
setupChar()
player.CharacterAdded:Connect(setupChar)

--------------------------------------------------
-- FLY
--------------------------------------------------
local FlyEnabled = false
local FlySpeed = 60
local bv, bg

local function startFly()
	if FlyEnabled then return end
	FlyEnabled = true
	humanoid.PlatformStand = true

	bv = Instance.new("BodyVelocity")
	bv.MaxForce = Vector3.new(1e9,1e9,1e9)
	bv.Parent = hrp

	bg = Instance.new("BodyGyro")
	bg.MaxTorque = Vector3.new(1e9,1e9,1e9)
	bg.P = 1e5
	bg.Parent = hrp
end

local function stopFly()
	FlyEnabled = false
	humanoid.PlatformStand = false
	if bv then bv:Destroy() end
	if bg then bg:Destroy() end
	hrp.AssemblyLinearVelocity = Vector3.zero
end

RunService.RenderStepped:Connect(function()
	if not FlyEnabled or not bv or not bg then return end

	local dir = Vector3.zero
	if UIS:IsKeyDown(Enum.KeyCode.W) then dir += camera.CFrame.LookVector end
	if UIS:IsKeyDown(Enum.KeyCode.S) then dir -= camera.CFrame.LookVector end
	if UIS:IsKeyDown(Enum.KeyCode.A) then dir -= camera.CFrame.RightVector end
	if UIS:IsKeyDown(Enum.KeyCode.D) then dir += camera.CFrame.RightVector end
	if UIS:IsKeyDown(Enum.KeyCode.Space) then dir += camera.CFrame.UpVector end
	if UIS:IsKeyDown(Enum.KeyCode.LeftShift) then dir -= camera.CFrame.UpVector end

	if dir.Magnitude > 0 then
		dir = dir.Unit * FlySpeed
	end

	bv.Velocity = dir
	bg.CFrame = camera.CFrame
end)

PlayerTab:CreateToggle({
	Name = "Fly",
	Callback = function(v)
		if v then startFly() else stopFly() end
	end
})

PlayerTab:CreateInput({
	Name = "Fly Speed",
	PlaceholderText = "e.g. 120",
	Callback = function(v)
		local n = tonumber(v)
		if n then FlySpeed = n end
	end
})

--------------------------------------------------
-- JUMP BOOST
--------------------------------------------------
local JumpBoost = false
local JumpPower = 100

PlayerTab:CreateToggle({
	Name = "Jump Boost",
	Callback = function(v)
		JumpBoost = v
		humanoid.JumpPower = v and JumpPower or 50
	end
})

PlayerTab:CreateInput({
	Name = "Jump Power",
	PlaceholderText = "e.g. 150",
	Callback = function(v)
		local n = tonumber(v)
		if n then
			JumpPower = n
			if JumpBoost then
				humanoid.JumpPower = n
			end
		end
	end
})

--------------------------------------------------
-- INVISIBLE
--------------------------------------------------
PlayerTab:CreateToggle({
	Name = "Invisible",
	Callback = function(v)
		for _,p in pairs(character:GetDescendants()) do
			if p:IsA("BasePart") then
				p.LocalTransparencyModifier = v and 1 or 0
			end
		end
	end
})

--------------------------------------------------
-- NOCLIP
--------------------------------------------------
local Noclip = false
RunService.Stepped:Connect(function()
	if not character then return end
	for _,p in pairs(character:GetDescendants()) do
		if p:IsA("BasePart") then
			p.CanCollide = not Noclip
		end
	end
end)

PlayerTab:CreateToggle({
	Name = "Noclip",
	Callback = function(v)
		Noclip = v
	end
})

--------------------------------------------------
-- CAR FLY + AUTO BOOST
--------------------------------------------------
local CarFly = false
local AutoBoost = false
local CarSpeed = 120

RunService.RenderStepped:Connect(function()
	local seat = humanoid.SeatPart
	if seat and seat:IsA("VehicleSeat") then
		if AutoBoost and seat.Throttle ~= 0 then
			seat.MaxSpeed = CarSpeed
		end
		if CarFly then
			seat.AssemblyLinearVelocity =
				camera.CFrame.LookVector * CarSpeed
		end
	end
end)

VehicleTab:CreateToggle({
	Name = "Car Fly",
	Callback = function(v)
		CarFly = v
	end
})

VehicleTab:CreateToggle({
	Name = "Auto Boost",
	Callback = function(v)
		AutoBoost = v
	end
})

VehicleTab:CreateInput({
	Name = "Car Speed",
	PlaceholderText = "e.g. 200",
	Callback = function(v)
		local n = tonumber(v)
		if n then CarSpeed = n end
	end
})

--------------------------------------------------
-- TEAM HITBOX / ESP
--------------------------------------------------
local TeamESP = false
local espBoxes = {}

local function clearESP()
	for _,box in pairs(espBoxes) do
		box:Destroy()
	end
	espBoxes = {}
end

local function createESP(plr)
	if plr == player then return end
	if not plr.Character then return end
	local root = plr.Character:FindFirstChild("HumanoidRootPart")
	if not root then return end

	local box = Instance.new("BoxHandleAdornment")
	box.Adornee = root
	box.Size = Vector3.new(4,6,4)
	box.AlwaysOnTop = true
	box.ZIndex = 5
	box.Transparency = 0.7
	box.Color3 = plr.Team and plr.Team.TeamColor.Color or Color3.new(1,0,0)
	box.Parent = root

	espBoxes[plr] = box
end

RunService.RenderStepped:Connect(function()
	if not TeamESP then
		clearESP()
		return
	end

	for _,plr in pairs(Players:GetPlayers()) do
		if plr ~= player then
			if not espBoxes[plr] then
				createESP(plr)
			else
				if plr.Team then
					espBoxes[plr].Color3 = plr.Team.TeamColor.Color
				end
			end
		end
	end
end)

VisualTab:CreateToggle({
	Name = "Team ESP (Hitbox)",
	Callback = function(v)
		TeamESP = v
		if not v then
			clearESP()
		end
	end
})

--------------------------------------------------
-- ANTI-JAIL / ANTI-RESPAWN TELEPORT
--------------------------------------------------
local AntiJail = true
local lastHRPPos = hrp.Position

RunService.RenderStepped:Connect(function()
	if AntiJail and hrp then
		if (hrp.Position - lastHRPPos).Magnitude < 0.1 and not FlyEnabled then
			-- Prevent back teleport
			hrp.CFrame = CFrame.new(lastHRPPos)
		else
			lastHRPPos = hrp.Position
		end
	end
end)

PlayerTab:CreateToggle({
	Name = "Anti-Jail/Anti-Respawn TP",
	Callback = function(v)
		AntiJail = v
	end
})

--------------------------------------------------
Rayfield:Notify({
	Title = "Loaded",
	Content = "Fly • JumpBoost • CarFly • AutoBoost • Invisible • Noclip • Anti-AFK • Team ESP • Anti-Jail",
	Duration = 5
})
